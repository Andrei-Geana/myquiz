<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <title>Quiz Details</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
</head>
<body>

<div th:insert="~{fragments::menu}"></div>
<div style="clear:both; margin-bottom:20px;"></div>

<h4 th:text="'Quiz Details: ' + ${quiz.name}">Quiz Details</h4>

<div style="margin: 20px 0;">
    <table class="styled-table" style="width: 50%;">
        <tr>
            <td><strong>Quiz ID:</strong></td>
            <td th:text="${quiz.id}">N/A</td>
        </tr>
        <tr>
            <td><strong>Quiz Name:</strong></td>
            <td th:text="${quiz.name}">N/A</td>
        </tr>
        <tr>
            <td><strong>Course:</strong></td>
            <td th:text="${quiz.course}">N/A</td>
        </tr>
        <tr>
            <td><strong>Year:</strong></td>
            <td th:text="${quiz.year}">N/A</td>
        </tr>
        <tr>
            <td><strong>Source File:</strong></td>
            <td th:text="${quiz.sourceFile}">N/A</td>
        </tr>
        <tr>
            <td><strong>Multiple Choice Questions:</strong></td>
            <td th:text="${quiz.questionsMC != null ? quiz.questionsMC.size() : 0}">0</td>
        </tr>
        <tr>
            <td><strong>True/False Questions:</strong></td>
            <td th:text="${quiz.questionsTF != null ? quiz.questionsTF.size() : 0}">0</td>
        </tr>
        <tr>
            <td><strong>Total Questions:</strong></td>
            <td th:text="${(quiz.questionsMC != null ? quiz.questionsMC.size() : 0) + (quiz.questionsTF != null ? quiz.questionsTF.size() : 0)}">0</td>
        </tr>
        <tr>
            <td><strong>Number of Authors:</strong></td>
            <td th:text="${quiz.noAuthors}">0</td>
        </tr>
    </table>
</div>

<div class="action-buttons" style="margin: 30px 0;">
    <a th:href="@{'/quiz/edit/' + ${quiz.id}}" class="btn btn-edit">Edit Quiz</a>
    <a th:href="@{'/question-list/' + ${quiz.course}}" class="btn btn-edit">View Questions</a>
    <a th:href="@{'/authors/?selectedCourse=' + ${quiz.course}}" class="btn btn-edit">View Authors</a>
    <a th:href="@{'/quiz/'}" class="btn btn-add">Back to Quiz List</a>
    <button th:onclick="|deleteQuiz(${quiz.id})|" class="btn btn-delete">Delete Quiz</button>
</div>

<div th:if="${quiz.questionsMC != null and quiz.questionsMC.size() > 0}" style="margin-top: 40px;">
    <h5>Multiple Choice Questions Preview</h5>
    <table class="styled-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Question Text</th>
                <th>Author</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="question, iterStat : ${quiz.questionsMC}" th:if="${iterStat.index < 5}">
                <td th:text="${question.id}">N/A</td>
                <td th:text="${#strings.abbreviate(question.question, 100)}">N/A</td>
                <td th:text="${question.authorName}">N/A</td>
            </tr>
            <tr th:if="${quiz.questionsMC.size() > 5}">
                <td colspan="3" style="text-align: center; font-style: italic;">
                    ... and <span th:text="${quiz.questionsMC.size() - 5}">0</span> more questions
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div th:if="${quiz.questionsTF != null and quiz.questionsTF.size() > 0}" style="margin-top: 40px;">
    <h5>True/False Questions Preview</h5>
    <table class="styled-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Question Text</th>
                <th>Author</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="question, iterStat : ${quiz.questionsTF}" th:if="${iterStat.index < 5}">
                <td th:text="${question.id}">N/A</td>
                <td th:text="${#strings.abbreviate(question.question, 100)}">N/A</td>
                <td th:text="${question.authorName}">N/A</td>
            </tr>
            <tr th:if="${quiz.questionsTF.size() > 5}">
                <td colspan="3" style="text-align: center; font-style: italic;">
                    ... and <span th:text="${quiz.questionsTF.size() - 5}">0</span> more questions
                </td>
            </tr>
        </tbody>
    </table>
</div>

<script>
function deleteQuiz(quizId) {
    if (confirm('Are you sure you want to delete this quiz? This will also delete all associated questions. This action cannot be undone.')) {
        window.location.href = '/quiz/' + quizId + '/delete';
    }
}
</script>

</body>
</html>
