<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1">
    <title>Authors List</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
</head>
<body>

<div th:insert="~{fragments::menu}"></div>
<div style="clear:both; margin-bottom:20px;"></div>

<div class="searchfilters">
    <form method="post" th:action="@{/authors/}">
        <label for="courseFilter">Filter by Course:</label>
        <select id="courseFilter" name="course">
            <option value="">All Courses</option>
            <option th:each="course : ${courses}" th:value="${course}" th:text="${course}" th:selected="${course == selectedCourse}"></option>
        </select>
        <button type="submit" class="btn btn-filter">Filter</button>
    </form>
</div>

<!-- Course selection dropdown -->


<table class="styled-table">
    <thead>
    <tr>
        <th>Id</th>
        <th>Author Name</th>
        <th>Initials</th>
        <th>MC Questions</th>
        <th>TF Questions</th>
        <th>Total Questions</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="author : ${authors}" class="data-row">
        <td th:text="${author.id}"></td>
        <td th:text="${author.name}"></td>
        <td th:text="${author.initials}"></td>
        <td th:text="${author.numberOfMultipleChoiceQuestions}"></td>
        <td th:text="${author.numberOfTrueFalseQuestions}"></td>
        <td th:text="${author.numberOfQuestions}"></td>
        <td class="action-cell">
            <a th:href="@{'/authors/author/' + ${author.name}}" class="btn btn-edit">View</a>
            <a th:href="@{'/author/edit/' + ${author.id}}" class="btn btn-edit">Edit</a>
            <button th:onclick="|deleteAuthor(${author.id})|" class="btn btn-delete">Delete</button>
        </td>
    </tr>
    <tr th:if="${#lists.isEmpty(authors)}" class="empty-row">
        <td colspan="7">No authors found</td>
    </tr>
    </tbody>
</table>

<!-- Pagination Controls -->
<div class="pagination" th:if="${totalPages > 1}" style="margin-top:20px;">
    <a th:if="${currentPage > 1}" th:href="@{'/authors?pageNo=' + ${currentPage - 1}}" class="btn btn-page">Previous</a>
    <span th:text="'Page ' + ${currentPage} + ' of ' + ${totalPages}"></span>
    <a th:if="${currentPage < totalPages}" th:href="@{'/authors?pageNo=' + ${currentPage + 1}}" class="btn btn-page">Next</a>
</div>

<script>
function deleteAuthor(authorId) {
    if (confirm('Are you sure you want to delete this author? This action cannot be undone.')) {
        fetch('/api/author/' + authorId, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            if (response.ok) {
                alert('Author deleted successfully!');
                location.reload();
            } else {
                return response.text().then(text => {
                    throw new Error(text || 'Unknown error occurred');
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting author: ' + error.message);
        });
    }
}
</script>

</body>
</html>
