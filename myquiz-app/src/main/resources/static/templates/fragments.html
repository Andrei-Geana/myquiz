<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" type="text/css" href="../css/styles.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
</head>
<body>

<div th:fragment="menu" class="menu">
    <div class="main-menu-item" tabindex="0">
        <span>📝 Quizzes ▾</span>
        <div class="main-submenu">
            <a th:href="@{'/quiz/'}">Quizzes List</a>
            <a th:href="@{'/quiz/new'}">+ Add New Quiz</a>
        </div>
    </div>
    <div class="main-menu-item" tabindex="0">
        <span>👥 Authors ▾</span>
        <div class="main-submenu">
            <a th:href="@{'/authors/?selectedCourse=' + ${selectedCourse}}">Authors Management</a>
            <a th:href="@{'/author/new'}">+ Add New Author</a>
        </div>
    </div>
    <a th:href="@{'/errors/?selectedCourse=' + ${selectedCourse}}" class="main-menu-item">❌ Errors</a>
    <div class="main-menu-item" tabindex="0">
        <span>📚 Courses</span>
        <div class="main-submenu">
            <a th:href="@{'/courses/'}">Course List</a>
            <a th:href="@{'/courses/new'}">+ Add New Course</a>
        </div>
    </div>
    <a th:href="@{'/uploadform'}" class="main-menu-item">📤 Upload</a>
    <a th:href="@{'/question-correction'}" class="main-menu-item">🤖 AI Correction</a>
    <div class="main-menu-item" tabindex="0">
        <span>🔧 Question Editor ▾</span>
        <div class="main-submenu">
            <a th:href="@{'/question-editor?type=MC'}">+ Add MC</a>
            <a th:href="@{'/question-editor?type=TF'}">+ Add TF</a>
        </div>
    </div>
    <a th:href="@{'/swagger-ui.html'}" class="main-menu-item" target="_blank">📋 API Docs</a>
    <a th:href="@{'/questions/deleteall'}" class="main-menu-item"
       th:onclick="return confirm('Are you sure you want to delete all the database records?')">🗑️ Delete all</a>
    <a th:href="@{'/about'}" class="main-menu-item">ℹ️ About</a>
</div>

<div th:fragment="quizfilter" class="quizfilter">
    <form method="POST" enctype="multipart/form-data" th:action="@{'/' + ${route}}">
        <select name="course">
            <option value="" disabled selected>Select quiz</option>
            <option th:each="course:${courses}"
                    th:value="${course}"
                    th:text="${course}"
                    th:selected="(${course == selectedCourse})"></option>
        </select>
        <input type="submit" value="Filter" />
    </form>
</div>
<div th:fragment="searchauthor" class="searchauthor">
    <form method="POST" enctype="multipart/form-data" th:action="@{'/authors/search'}">
        <input type="text" name="search" placeholder="Author name" />
        <input type="submit" value="Search author" />
    </form>
</div>

<div th:fragment="deletecourse" class="deletecourse">
    <form method="POST" enctype="multipart/form-data" th:action="@{'/' + ${route}}">
        <select name="course">
            <option value="" disabled selected>Select course</option>
            <option th:each="course:${courses}"
                    th:value="${course}"
                    th:text="${course}"
                    th:selected="(${course == selectedCourse})"></option>
        </select>
        <input type="submit" value="Delete course" />
    </form>
</div>

<script>
// Improved: Show/hide submenu on hover and focus for accessibility
function setupDropdown() {
    document.querySelectorAll('.main-menu-item').forEach(function(menuItem) {
        var submenu = menuItem.querySelector('.main-submenu');
        if (!submenu) return;
        menuItem.addEventListener('mouseenter', function() {
            submenu.style.display = 'block';
        });
        menuItem.addEventListener('mouseleave', function() {
            submenu.style.display = 'none';
        });
        menuItem.addEventListener('focusin', function() {
            submenu.style.display = 'block';
        });
        menuItem.addEventListener('focusout', function(e) {
            if (!menuItem.contains(e.relatedTarget)) {
                submenu.style.display = 'none';
            }
        });
    });
}
setupDropdown();
</script>

</body>
</html>